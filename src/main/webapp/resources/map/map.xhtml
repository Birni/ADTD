<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:composite="http://xmlns.jcp.org/jsf/composite">



<composite:interface>
    <composite:attribute name="mapCenterLatitude" />
    <composite:attribute name="mapCenterLongitude" />
    <composite:attribute name="mapDraggingEnabled" />
    <composite:attribute name="mapZoomControl" />
    <composite:attribute name="mapZoom" />
    <composite:attribute name="mapUrlTemplate" />
    <composite:attribute name="mapMaxZoom" />
    <composite:attribute name="mapMinZoom" />

    <composite:attribute name="mapLocations" type="java.lang.Object" />
    <composite:attribute name="mapMarker" type="java.lang.Object" />
    <composite:attribute name="mapRoute" type="java.lang.Object" />
</composite:interface>

<composite:implementation>

    <!-- <ui:debug />-->

    <head>
        <!--  <link rel="stylesheet" href="" />
          <script src="#{resource['../../META-INF/resources/webjars/leaflet/1.5.1/leaflet.js']}" type="text/javascript']}"> </script> -->

        <link rel="stylesheet" href="webjars/leaflet/1.5.1/leaflet.css"/>
        <script type="text/javascript" language="javascript" src="webjars/leaflet/1.5.1/leaflet.js"></script>
    </head>


    <div id="#{cc.attrs.id}" style="width:100%; height:100%; position: absolute;"/>

     <script type="text/javascript">

         var map_#{cc.attrs.id} = L.map('#{cc.attrs.id}', {center: ["#{cc.attrs.mapCenterLatitude}" ,"#{cc.attrs.mapCenterLongitude}"],
             dragging:#{cc.attrs.mapDraggingEnabled}, zoomControl:#{cc.attrs.mapZoomControl}, zoom:"#{cc.attrs.mapZoom}"});


         L.tileLayer('#{cc.attrs.mapUrlTemplate}', {id: 'osm', maxZoom:"#{cc.attrs.mapMaxZoom}", minZoom:"#{cc.attrs.mapMinZoom}"}).addTo(map_#{cc.attrs.id});

          <ui:repeat value="#{cc.attrs.mapLocations}" var="location">
          var myStyle = {
              "color": "#557A95",
              "weight": 5,
              "opacity": 0.90};

          L.geoJSON(#{location.getJsonString()}, {style: myStyle}).addTo(map_#{cc.attrs.id});

          </ui:repeat>

          <ui:repeat value="#{cc.attrs.mapRoute}" var="route">
          var myStyle = {
              "color": "#e659ff",
              "weight": 5,
              "opacity": 0.65
          };

          L.geoJSON(#{route.getJsonString()}, {style: myStyle}).addTo(map_#{cc.attrs.id});

          </ui:repeat>




         <ui:repeat value="#{cc.attrs.mapMarker}" var="marker">

         var Icon = L.icon({
             iconUrl: 'resources/images/iconTransporter.png',
             iconSize: [24, 24]
             });


         var marker = L.marker([#{marker.position.latitude} ,  #{marker.position.longitude}] ,{icon: Icon}).addTo(map_#{cc.attrs.id});

         </ui:repeat>

         function onMapClick(e) {
             alert("You clicked the map at " + e.latlng);
         }
         map_#{cc.attrs.id}.on('click', onMapClick);




     </script>



 </composite:implementation>


 </html>