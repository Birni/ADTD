<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:composite="http://xmlns.jcp.org/jsf/composite">


<composite:interface componentType="adtdMap">
    <composite:attribute name="map" type="java.lang.Object" />
</composite:interface>

<composite:implementation>

    <!-- <ui:debug />-->

    <head>
        <!--  <link rel="stylesheet" href="" />
          <script src="#{resource['../../META-INF/resources/webjars/leaflet/1.5.1/leaflet.js']}" type="text/javascript']}"> </script> -->

        <link rel="stylesheet" href="webjars/leaflet/1.5.1/leaflet.css"/>
        <script type="text/javascript" language="javascript" src="webjars/leaflet/1.5.1/leaflet.js"></script>
    </head>


    <div id="#{cc.attrs.id}" style="width:#{cc.myMap.width}; height:#{cc.myMap.height};"/>


    <script type="text/javascript">

        var map_#{cc.attrs.id} = L.map('#{cc.attrs.id}', {center: [#{cc.myMap.mapCenter.latitude},#{cc.myMap.mapCenter.longitude}], dragging: #{cc.myMap.draggingEnabled}, zoomControl: #{cc.myMap.zoomControl} , zoom: #{cc.myMap.zoom}});

        L.tileLayer('#{cc.myMap.urlTemplate}', {id: 'osm', attribution: '#{cc.myMap.attribution}', maxZoom: #{cc.myMap.maxZoom}, minZoom: #{cc.myMap.minZoom}}).addTo(map_#{cc.attrs.id}).addTo(map_#{cc.attrs.id});


        <ui:repeat value="#{cc.myMap.layers}" var="layer">

        <ui:repeat value="#{layer.markers}" var="marker">

        var marker = L.marker([#{marker.position.latitude} ,  #{marker.position.longitude}]).addTo(map_#{cc.attrs.id});

        </ui:repeat>

        <ui:repeat value="#{layer.locations}" var="location">
        var myStyle = {
            "color": "#ff7800",
            "weight": 5,
            "opacity": 0.65};

        L.geoJSON(#{location.getJsonString()}, myStyle).addTo(map_#{cc.attrs.id});

        </ui:repeat>

        <ui:repeat value="#{layer.routes}" var="route">
        var myStyle = {
            "color": "#e659ff",
            "weight": 5,
            "opacity": 0.65
        };

        L.geoJSON(#{route.getJsonString()}, {style: myStyle}).addTo(map_#{cc.attrs.id});

        </ui:repeat>


        </ui:repeat>



        function onMapClick(e) {
            alert("You clicked the map at " + e.latlng);
        }

        map_#{cc.attrs.id}.on('click', onMapClick);


    </script>

</composite:implementation>


</html>